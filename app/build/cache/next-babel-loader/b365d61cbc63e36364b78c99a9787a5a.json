{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nvar _dec, _class;\n\nvar __jsx = React.createElement;\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"]; if (!it) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it[\"return\"] != null) it[\"return\"](); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from \"react\";\nimport qs from \"querystring\";\nimport { connect } from \"react-redux\";\nimport { autobind } from \"react-decoration\";\nimport Link from \"next/link\";\nimport Router from \"next/router\";\nimport { withRouter } from \"next/router\";\nimport Modal from \"components/Modal\";\nimport ReactImages from \"components/ReactImages\";\nimport Sidebar from \"components/ReactSidebar\";\nimport { pathToRegexp } from \"path-to-regexp\";\nimport pages from \"constants/pages\";\nimport { action } from \"modules\";\nimport * as api from \"api\";\nimport css from \"./Main.module.scss\";\nimport TokenService from \"../../services/token-service\";\nimport IdleService from \"../../services/idle-service\";\nvar ignorePaths = [\"/demo\", \"/register\"];\nvar Main = (_dec = connect(), withRouter(_class = _dec(_class = /*#__PURE__*/function (_React$Component) {\n  _inherits(Main, _React$Component);\n\n  var _super = _createSuper(Main);\n\n  function Main() {\n    var _this;\n\n    _classCallCheck(this, Main);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      loaded: false,\n      sidebar: false\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"logout\", function () {\n      TokenService.clearAuthToken();\n      TokenService.clearCallbackBeforeExpiry();\n      IdleService.unRegisterIdleResets();\n      return Router.replace(\"/\");\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"isCurrentDirectory\", function (page) {\n      var pathname = _this.props.router.pathname;\n      return page.page && pathToRegexp(page.page).exec(pathname);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getCurrentPage\", function () {\n      var _pages = pages.sidebar;\n      var pathname = _this.props.router.pathname;\n\n      var _iterator = _createForOfIteratorHelper(_pages.filter(function (item) {\n        return typeof item !== \"string\";\n      })),\n          _step;\n\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var page = _step.value;\n          if (page.page && pathToRegexp(page.page).exec(pathname)) return page;\n\n          if (page.menu) {\n            var _iterator2 = _createForOfIteratorHelper(page.menu),\n                _step2;\n\n            try {\n              for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n                var item = _step2.value;\n                if (pathToRegexp(item.page).exec(pathname)) return item;\n              }\n            } catch (err) {\n              _iterator2.e(err);\n            } finally {\n              _iterator2.f();\n            }\n          }\n\n          if (page.sub_pages) {\n            var _iterator3 = _createForOfIteratorHelper(page.sub_pages),\n                _step3;\n\n            try {\n              for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n                var _item = _step3.value;\n                if (pathToRegexp(_item.page).exec(pathname)) return _item;\n              }\n            } catch (err) {\n              _iterator3.e(err);\n            } finally {\n              _iterator3.f();\n            }\n          }\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getSidebar\", function () {\n      var sidebar = JSON.parse(JSON.stringify(pages.sidebar)); // if (process.env.NEXT_PUBLIC_PERMISSION_ENABLED !== \"true\")\n      // \treturn sidebar;\n\n      var user = _this.props.user;\n      var polices = (user === null || user === void 0 ? void 0 : user.permissions) || [];\n      sidebar = sidebar.map(function (page) {\n        if (page.type == \"dropdown\") {\n          page.menu = page.menu.filter(function (page) {\n            if (page.permissions && page.permissions.length > 0) {\n              return page.permissions.every(function (permission) {\n                return polices.includes(permission);\n              });\n            }\n\n            return true;\n          });\n        }\n\n        return page;\n      }).filter(function (page) {\n        if (page.type == \"dropdown\") {\n          return page.menu.length > 0;\n        } else if (page.permissions && page.permissions.length > 0) {\n          return page.permissions.every(function (permission) {\n            return polices.includes(permission);\n          });\n        }\n\n        return true;\n      });\n      return sidebar;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderSidebar\", function () {\n      return __jsx(React.Fragment, null, __jsx(\"ul\", {\n        className: css[\"sidebar-list-narrow\"]\n      }, _this.getSidebar().map(function (item, index) {\n        if (typeof item == \"string\") return __jsx(React.Fragment, {\n          key: index\n        });\n\n        if (item.type == \"dropdown\") {\n          var _item$menu;\n\n          return __jsx(\"li\", {\n            key: index,\n            className: css[\"dropdown-narrow\"]\n          }, __jsx(\"a\", null, __jsx(\"i\", {\n            className: item.icon\n          })), __jsx(\"ul\", {\n            className: css[\"sidebar-list\"]\n          }, ((_item$menu = item.menu) !== null && _item$menu !== void 0 ? _item$menu : []).map(function (item, index) {\n            return __jsx(\"li\", {\n              key: index,\n              className: _this.isCurrentDirectory(item) ? css[\"active-item\"] : void 0\n            }, __jsx(Link, {\n              href: item.page\n            }, __jsx(\"a\", null, __jsx(\"i\", {\n              className: item.icon\n            }), __jsx(\"span\", null, item.name))));\n          })));\n        }\n\n        return __jsx(\"li\", {\n          key: index,\n          className: _this.isCurrentDirectory(item) ? css[\"active-item\"] : void 0\n        }, __jsx(Link, {\n          href: item.page\n        }, __jsx(\"a\", null, __jsx(\"i\", {\n          className: item.icon\n        }))));\n      })), __jsx(\"ul\", {\n        className: css[\"sidebar-list-narrow\"]\n      }, __jsx(\"li\", {\n        onClick: _this.logout\n      }, __jsx(\"a\", null, __jsx(\"i\", {\n        className: \"fa fa-sign-out\"\n      })))));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderFullSidebar\", function () {\n      return __jsx(React.Fragment, null, __jsx(\"ul\", {\n        className: css[\"sidebar-list\"]\n      }, _this.getSidebar().map(function (item, index) {\n        if (typeof item == \"string\") return __jsx(\"li\", {\n          key: index,\n          className: css.catalog\n        }, __jsx(\"span\", null, item));\n\n        if (item.type == \"dropdown\") {\n          var _item$menu2;\n\n          return __jsx(\"li\", {\n            key: index,\n            className: css.dropdown\n          }, __jsx(\"a\", null, __jsx(\"span\", null, __jsx(\"i\", {\n            className: item.icon\n          }), __jsx(\"span\", null, item.name)), __jsx(\"i\", {\n            className: \"fa fa-angle-right\"\n          })), __jsx(\"ul\", {\n            className: css[\"sidebar-list\"]\n          }, ((_item$menu2 = item.menu) !== null && _item$menu2 !== void 0 ? _item$menu2 : []).map(function (item, index) {\n            return __jsx(\"li\", {\n              key: index,\n              className: _this.isCurrentDirectory(item) ? css[\"active-item\"] : void 0\n            }, __jsx(Link, {\n              href: item.page\n            }, __jsx(\"a\", null, __jsx(\"i\", {\n              className: item.icon\n            }), __jsx(\"span\", null, item.name))));\n          })));\n        }\n\n        return __jsx(\"li\", {\n          key: index,\n          className: _this.isCurrentDirectory(item) ? css[\"active-item\"] : void 0\n        }, __jsx(Link, {\n          href: item.page\n        }, __jsx(\"a\", null, __jsx(\"i\", {\n          className: item.icon\n        }), __jsx(\"span\", null, item.name))));\n      })), __jsx(\"ul\", {\n        className: css[\"sidebar-list\"]\n      }, __jsx(\"li\", {\n        onClick: _this.logout\n      }, __jsx(\"a\", null, __jsx(\"i\", {\n        className: \"fa fa-sign-out\"\n      }), __jsx(\"span\", null, \"Sign out\")))));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderContent\", function () {\n      var sidebar = _this.state.sidebar;\n      var pathname = _this.props.router.pathname;\n\n      if ([\"/\", \"/login\", \"/demo\", \"/register\"].includes(pathname)) {\n        return _this.props.children;\n      }\n\n      var currentPage = _this.getCurrentPage();\n\n      return __jsx(React.Fragment, null, __jsx(\"nav\", {\n        className: css.navbar\n      }, __jsx(\"div\", {\n        className: css[sidebar ? \"navbar-header\" : \"navbar-header-narrow\"]\n      }), __jsx(\"div\", {\n        className: css[\"navbar-main\"],\n        onClick: function onClick() {\n          return _this.setState({\n            sidebar: !sidebar\n          });\n        }\n      }, __jsx(\"i\", {\n        className: \"fa fa-align-left pointer\"\n      }), __jsx(\"h3\", null, currentPage === null || currentPage === void 0 ? void 0 : currentPage.name))), __jsx(\"div\", {\n        className: css[sidebar ? \"page-container\" : \"page-container-narrow\"] + \" error-page\"\n      }, __jsx(\"aside\", {\n        className: sidebar ? css.sidebar : css[\"sidebar-narrow\"]\n      }, sidebar ? _this.renderFullSidebar() : _this.renderSidebar()), __jsx(\"div\", {\n        className: css[\"page-content\"]\n      }, _this.props.children)));\n    });\n\n    return _this;\n  }\n\n  _createClass(Main, [{\n    key: \"render\",\n    value: function render() {\n      var loaded = this.state.loaded;\n      var pathname = this.props.router.pathname;\n      if (ignorePaths.includes(pathname)) return this.renderContent();\n      return __jsx(React.Fragment, null, __jsx(Sidebar, null, this.renderContent()), __jsx(Modal, null), __jsx(ReactImages, null));\n    }\n  }]);\n\n  return Main;\n}(React.Component)) || _class) || _class);\nexport default Main;","map":null,"metadata":{},"sourceType":"module"}